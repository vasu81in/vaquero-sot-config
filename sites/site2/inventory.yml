---
name: server2
interfaces:
  - type: physical
    subnet: pxenet
    mac: 3C:FD:FE:AB:64:40
    ipv4: 15.0.0.26
  - type: bmc
    subnet: management
    mac: 6C:B2:AE:C3:44:50
    ipv4: 172.28.123.138
    bmc:
        type: ipmi
        username: admin
        password: Lab1234!

metadata:
    name: server1
    network_config:
      - type: physical 
        name: pxeboot
        mac_address: 3c:fd:fe:ab:64:40
        subnets:
        - address:  15.0.0.26
          netmask:  255.255.255.0
          gateway:   15.0.0.2
          type:   static
      - type: physical
        name: samx1
        mac_address: 3c:fd:fe:ab:64:42
      - type: physical
        name:  samx2
        mac_address: 3c:fd:fe:ab:64:43
      - type: physical
        name:  pet1
        mtu: 9000
        mac_address: 3c:fd:fe:b0:8e:68
      - type: physical
        name:  pet2
        mtu: 9000
        mac_address: 3c:fd:fe:b0:8e:69
      - type: bond
        name: samx
        bond_interfaces:
        - samx1
        - samx2
        params:
          bond-mode: active-backup
      - type: team
        name: pet
        mtu: 9000
        bond_interfaces:
        - pet1
        - pet2
        params:
          bond-mode: active-backup
      - type: vlan
        name: samx.501
        vlan_link: samx
        vlan_id:   501
        subnets:
        - address:  26.0.0.28
          netmask:  255.255.255.0
          gateway:   26.0.0.1
          type:   static
      - type: vlan
        name:  pet.601
        vlan_link:  pet
        vlan_id:   601
        mtu: 9000
        subnets:
        - address:  36.0.0.28
          netmask:  255.255.255.0
          gateway:   36.0.0.1
          type:   static
      - type: vlan
        name: pet.701
        vlan_link:  pet
        vlan_id:   701
        mtu: 9000
        subnets:
        - address:  46.0.0.28
          netmask:  255.255.255.0
          gateway:   46.0.0.1
          type:   static
      - type: nameserver
        address:
          - 15.0.0.2
        search:
          - cisco.com
  
    disk_config:
      devices:   sda
      virtual_disks:
        - name: v0
          type:  HDD
          raid:  raid1
          num_disk: 2
          num_spare: 0
      partitions:
        - name:  /boot
          type:   ext3
          size:  300
        - name:  pv.root
          size:  800000
        - name:  swap
          size:  8192
          disk:  sda
      lvm:
        vg:
          - name: vg01
            pv:   pv.root
        lv:
          - name:  rootvol
            vg:    vg01
            size:  100000
            fstype:  xfs
            mount:  /
          - name:  homevol
            vg:    vg01
            size:  600000
            fstype:  xfs
            mount:  /home

    os_config:
      kernel:
        iommu: pt
        default_hugepagesz: 2M
        intel_iommu: on
        nmi_watchdog: 0
        elevator: cfq
        rd.driver.blacklist: nouveau
        nouveau.modeset: 0
      sysctl:
        net.ipv4.conf.all.rp_filter: 0
        net.ipv4.conf.default.rp_filter: 0
        net.ipv6.conf.all.disable_ipv6: 0
      repos:
        repo1:
          baseurl:  http://15.0.0.2/repo/rhel-7-server-rpms--x86_64
      packages:
        - kernel-devel
      post_install_commands:
        -  'echo "blacklist nouveau" >> /etc/modprobe.d/blacklist.conf' 
        -  'mv /boot/initramfs-$(uname -r).img /boot/initramfs-$(uname -r)-nouveau.img'
        -  'dracut /boot/initramfs-$(uname -r).img $(uname -r)'
        -  'systemctl isolate multi-user.target'

workflow: redhat
